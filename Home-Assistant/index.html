<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for EMS-ESP"><link href=https://emsesp.github.io/docs/Home-Assistant/ rel=canonical><link href=../Integrations/ rel=prev><link href=../IOBroker/ rel=next><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.34"><title>Home Assistant - EMS-ESP</title><link rel=stylesheet href=../assets/stylesheets/main.35f28582.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><link rel=stylesheet href=../assets/css/github.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-SVDSJ3QTVC"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-SVDSJ3QTVC",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-SVDSJ3QTVC",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#example-automations class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=EMS-ESP class="md-header__button md-logo" aria-label=EMS-ESP data-md-component=logo> <img src=../_media/logo/boiler.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EMS-ESP </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Home Assistant </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-hidden=true type=radio name=__palette id=__palette_0> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/emsesp/EMS-ESP32 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> emsesp/EMS-ESP32 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../All-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../Integrations/ class=md-tabs__link> Integrations </a> </li> <li class=md-tabs__item> <a href=../Support/ class=md-tabs__link> Help </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=EMS-ESP class="md-nav__button md-logo" aria-label=EMS-ESP data-md-component=logo> <img src=../_media/logo/boiler.svg alt=logo> </a> EMS-ESP </label> <div class=md-nav__source> <a href=https://github.com/emsesp/EMS-ESP32 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> emsesp/EMS-ESP32 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> News </span> </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> <span class=md-ellipsis> About EMS-ESP </span> </a> </li> <li class=md-nav__item> <a href=../Version-Release-History/ class=md-nav__link> <span class=md-ellipsis> Version Release History </span> </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../Configuring/ class=md-nav__link> <span class=md-ellipsis> Configuring </span> </a> </li> <li class=md-nav__item> <a href=../Special-Functions/ class=md-nav__link> <span class=md-ellipsis> Special Functions </span> </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> <span class=md-ellipsis> WebUI </span> </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_9> <label class=md-nav__link for=__nav_1_9 id=__nav_1_9_label tabindex=0> <span class=md-ellipsis> Modbus/TCP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_9_label aria-expanded=false> <label class=md-nav__title for=__nav_1_9> <span class="md-nav__icon md-icon"></span> Modbus/TCP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Modbus/ class=md-nav__link> <span class=md-ellipsis> Modbus </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Settings/ class=md-nav__link> <span class=md-ellipsis> Settings </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Server-IDs/ class=md-nav__link> <span class=md-ellipsis> Server Unit Identifiers </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-System-Server/ class=md-nav__link> <span class=md-ellipsis> The SYSTEM Server </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Register-Blocks/ class=md-nav__link> <span class=md-ellipsis> Register Block Offsets </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Entity-Registers/ class=md-nav__link> <span class=md-ellipsis> Entity Register Offsets </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../Console/ class=md-nav__link> <span class=md-ellipsis> Console </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_12> <label class=md-nav__link for=__nav_1_12 id=__nav_1_12_label tabindex=0> <span class=md-ellipsis> For Developers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_12_label aria-expanded=false> <label class=md-nav__title for=__nav_1_12> <span class="md-nav__icon md-icon"></span> For Developers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Building/ class=md-nav__link> <span class=md-ellipsis> Building & Testing the Firmware </span> </a> </li> <li class=md-nav__item> <a href=../Adding-Languages/ class=md-nav__link> <span class=md-ellipsis> Adding Languages </span> </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../EMS-bus/ class=md-nav__link> <span class=md-ellipsis> The EMS protocol </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Dev/ class=md-nav__link> <span class=md-ellipsis> Maintaining Modbus Parameters </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Supported Devices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../All-Devices/ class=md-nav__link> <span class=md-ellipsis> All Devices and Entities </span> </a> </li> <li class=md-nav__item> <a href=../Boilers/ class=md-nav__link> <span class=md-ellipsis> Boilers </span> </a> </li> <li class=md-nav__item> <a href=../Thermostats/ class=md-nav__link> <span class=md-ellipsis> Thermostats </span> </a> </li> <li class=md-nav__item> <a href=../Solar-Modules/ class=md-nav__link> <span class=md-ellipsis> Solar Modules </span> </a> </li> <li class=md-nav__item> <a href=../Mixer-Modules/ class=md-nav__link> <span class=md-ellipsis> Mixer Modules </span> </a> </li> <li class=md-nav__item> <a href=../Heat-Pumps/ class=md-nav__link> <span class=md-ellipsis> Heat Pumps </span> </a> </li> <li class=md-nav__item> <a href=../Controllers/ class=md-nav__link> <span class=md-ellipsis> Controllers </span> </a> </li> <li class=md-nav__item> <a href=../Switches/ class=md-nav__link> <span class=md-ellipsis> Switches </span> </a> </li> <li class=md-nav__item> <a href=../Other-Devices/ class=md-nav__link> <span class=md-ellipsis> Other Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Integrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Home Assistant </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Home Assistant </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-automations class=md-nav__link> <span class=md-ellipsis> Example Automations </span> </a> <nav class=md-nav aria-label="Example Automations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#alert-when-ems-esp-boots class=md-nav__link> <span class=md-ellipsis> Alert when EMS-ESP boots </span> </a> </li> <li class=md-nav__item> <a href=#shower-integration class=md-nav__link> <span class=md-ellipsis> Shower Integration </span> </a> </li> <li class=md-nav__item> <a href=#alert-change-of-thermostat-set-temperature class=md-nav__link> <span class=md-ellipsis> Alert change of thermostat set temperature </span> </a> </li> <li class=md-nav__item> <a href=#activating-one-time-hot-water-charging-dhw-once-using-mqtt class=md-nav__link> <span class=md-ellipsis> Activating one-time hot water charging DHW once using MQTT </span> </a> </li> <li class=md-nav__item> <a href=#calculating-values class=md-nav__link> <span class=md-ellipsis> Calculating values </span> </a> </li> <li class=md-nav__item> <a href=#solar-pump-working-hours class=md-nav__link> <span class=md-ellipsis> Solar Pump Working Hours </span> </a> </li> <li class=md-nav__item> <a href=#reading-a-value-via-the-api class=md-nav__link> <span class=md-ellipsis> Reading a value via the API </span> </a> </li> <li class=md-nav__item> <a href=#changing-a-value-via-the-api class=md-nav__link> <span class=md-ellipsis> Changing a value via the API </span> </a> </li> <li class=md-nav__item> <a href=#showing-the-boiler-status-based-on-the-service-code class=md-nav__link> <span class=md-ellipsis> Showing the Boiler status based on the service code </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../IOBroker/ class=md-nav__link> <span class=md-ellipsis> IOBroker </span> </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> <span class=md-ellipsis> Domoticz </span> </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> <span class=md-ellipsis> openHAB </span> </a> </li> <li class=md-nav__item> <a href=../Loxone/ class=md-nav__link> <span class=md-ellipsis> Loxone </span> </a> </li> <li class=md-nav__item> <a href=../Grafana/ class=md-nav__link> <span class=md-ellipsis> Grafana </span> </a> </li> <li class=md-nav__item> <a href=../Modbus/ class=md-nav__link> <span class=md-ellipsis> Modbus </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Help </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Support/ class=md-nav__link> <span class=md-ellipsis> Support </span> </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../tips-and-tricks/ class=md-nav__link> <span class=md-ellipsis> Tips & Tricks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-automations class=md-nav__link> <span class=md-ellipsis> Example Automations </span> </a> <nav class=md-nav aria-label="Example Automations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#alert-when-ems-esp-boots class=md-nav__link> <span class=md-ellipsis> Alert when EMS-ESP boots </span> </a> </li> <li class=md-nav__item> <a href=#shower-integration class=md-nav__link> <span class=md-ellipsis> Shower Integration </span> </a> </li> <li class=md-nav__item> <a href=#alert-change-of-thermostat-set-temperature class=md-nav__link> <span class=md-ellipsis> Alert change of thermostat set temperature </span> </a> </li> <li class=md-nav__item> <a href=#activating-one-time-hot-water-charging-dhw-once-using-mqtt class=md-nav__link> <span class=md-ellipsis> Activating one-time hot water charging DHW once using MQTT </span> </a> </li> <li class=md-nav__item> <a href=#calculating-values class=md-nav__link> <span class=md-ellipsis> Calculating values </span> </a> </li> <li class=md-nav__item> <a href=#solar-pump-working-hours class=md-nav__link> <span class=md-ellipsis> Solar Pump Working Hours </span> </a> </li> <li class=md-nav__item> <a href=#reading-a-value-via-the-api class=md-nav__link> <span class=md-ellipsis> Reading a value via the API </span> </a> </li> <li class=md-nav__item> <a href=#changing-a-value-via-the-api class=md-nav__link> <span class=md-ellipsis> Changing a value via the API </span> </a> </li> <li class=md-nav__item> <a href=#showing-the-boiler-status-based-on-the-service-code class=md-nav__link> <span class=md-ellipsis> Showing the Boiler status based on the service code </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Home Assistant</h1> <p><img alt=logo src=../_media/logo/home-assistant.png></p> <p>EMS-ESP has automatic integration with Home Assistant via the <a href=https://www.home-assistant.io/docs/mqtt/discovery/ >MQTT Discovery</a> protocol. To use this feature enable simply enable the Discovery option from the MQTT Settings page.</p> <p>EMS-ESP will create retained MQTT messages prefixed with <code>homeassistant/</code> for each device and their values (called entities). For example "<code>EMS-ESP Thermostat</code>". You can view which ones have been created by going into Home Assistant's <code>Configuration-&gt;Integrations</code> and select the devices under <code>MQTT</code>.</p> <p>To add this device and its values to a Home Assistant UI click on the "ADD TO LOVELACE" button.</p> <p><img alt=device src=../_media/screenshot/ha_device.png></p> <p>You can then add each of these devices to a new lovelace view using the "add to lovelace" button, and get something looking like:</p> <p><img alt=lovelace src=../_media/screenshot/ha_lovelace.png></p> <h2 id=example-automations>Example Automations<a class=headerlink href=#example-automations title="Permanent link">~</a></h2> <h3 id=alert-when-ems-esp-boots>Alert when EMS-ESP boots<a class=headerlink href=#alert-when-ems-esp-boots title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">EMS-ESP boots</span>
<span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Notify when EMS-ESP boots</span>
<span class=nt>trigger</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mqtt</span>
<span class=w>    </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ems-esp/heartbeat</span>
<span class=w>    </span><span class=nt>payload</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connecting</span>
<span class=w>    </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>value_json.bus_status</span><span class=nv> </span><span class=s>}}&#39;</span>
<span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
<span class=nt>action</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">notify.notify</span>
<span class=w>    </span><span class=nt>data</span><span class=p>:</span>
<span class=w>      </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">EMS-ESP</span>
<span class=w>      </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">EMS-ESP has booted</span>
<span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">single</span>
</code></pre></div> <h3 id=shower-integration>Shower Integration<a class=headerlink href=#shower-integration title="Permanent link">~</a></h3> <p>The below are additions to the HA files to show the state of the shower, if the setting <code>Shower Timer</code> is enabled in EMS-ESP.</p> <p>The cold shot feature is available in EMS-ESP versions 3.7.0-dev.1 and above.</p> <p><img alt="Home Assistant Shower" src=../_media/screenshot/ha_shower.jpg></p> <p><img alt="Home Assistant iPhone notify" src=../_media/screenshot/ha_notify.jpg></p> <p>Add to <code>configuration.yaml</code> (make sure you change the token):</p> <div class=highlight><pre><span></span><code><span class=nt>rest_command</span><span class=p>:</span>
<span class=w>  </span><span class=nt>emsesp</span><span class=p>:</span>
<span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>&#39;http://ems-esp.local/api/{{device}}&#39;</span>
<span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">POST</span>
<span class=w>    </span><span class=nt>headers</span><span class=p>:</span>
<span class=w>      </span><span class=nt>authorization</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Bearer</span><span class=nv> </span><span class=s>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiYWRtaW4iOnRydWV9.2bHpWya2C7Q12WjNUBD6_7N3RCD7CMl-EGhyQVzFdDg&#39;</span>
<span class=w>    </span><span class=nt>content_type</span><span class=p>:</span><span class=w> </span><span class=s>&#39;application/json&#39;</span>
<span class=w>    </span><span class=nt>payload</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{&quot;entity&quot;:&quot;{{entity}}&quot;,&quot;value&quot;:&quot;{{value}}&quot;}&#39;</span>
</code></pre></div> <p>Add to <code>scripts.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>coldshot</span><span class=p>:</span>
<span class=w>  </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Cold shot of water</span>
<span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">single</span>
<span class=w>  </span><span class=nt>sequence</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rest_command.emsesp</span>
<span class=w>      </span><span class=nt>data</span><span class=p>:</span>
<span class=w>        </span><span class=nt>device</span><span class=p>:</span><span class=w> </span><span class=s>&#39;boiler&#39;</span>
<span class=w>        </span><span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=s>&#39;coldshot&#39;</span>
<span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&#39;on&#39;</span>
</code></pre></div> <p>Add to <code>automations.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">shower_alert</span>
<span class=w>  </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Shower Alert</span>
<span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Shower Alert</span>
<span class=w>  </span><span class=nt>trigger</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>      </span><span class=nt>entity_id</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sensor.last_shower_duration</span>
<span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
<span class=w>  </span><span class=nt>action</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">notify.notify</span>
<span class=w>      </span><span class=nt>data</span><span class=p>:</span>
<span class=w>        </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Duration:</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>states(&#39;sensor.last_shower_duration&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>        </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Shower finished at {{ now().strftime(&quot;%H:%M&quot;) }}</span>
<span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">single</span>
</code></pre></div> <p>Add directly to the <code>configuration.yaml</code> or merge into an existing <code>sensors.yaml</code> file:</p> <div class=highlight><pre><span></span><code><span class=nt>sensor</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class=w>    </span><span class=nt>sensors</span><span class=p>:</span>
<span class=w>      </span><span class=nt>last_shower_duration</span><span class=p>:</span>
<span class=w>        </span><span class=nt>friendly_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Last shower duration</span>
<span class=w>        </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>int(states(&#39;sensor.ems_esp_shower_duration&#39;))</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>timestamp_custom(&#39;%-M</span><span class=nv> </span><span class=s>min</span><span class=nv> </span><span class=s>%-S</span><span class=nv> </span><span class=s>sec&#39;,</span><span class=nv> </span><span class=s>false)}}&quot;</span>
<span class=w>      </span><span class=nt>last_shower_time</span><span class=p>:</span>
<span class=w>        </span><span class=nt>friendly_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Last shower timestamp</span>
<span class=w>        </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>as_timestamp(states.sensor.ems_esp_shower_duration.last_updated)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>int</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>timestamp_custom(&quot;%-I:%M</span><span class=nv> </span><span class=s>%p</span><span class=nv> </span><span class=s>on</span><span class=nv> </span><span class=s>%a</span><span class=nv> </span><span class=s>%-d</span><span class=nv> </span><span class=s>%b&quot;)</span><span class=nv> </span><span class=s>}}&#39;</span>
</code></pre></div> <p>Note you can configure the <code>timestamp_custom()</code> to your own preferred format.</p> <p>Add a new card to an existing Dashboard. I'm using custom cards called 'mushroom' which can be installed via the HACS plugin. Such a card would look like:</p> <div class=highlight><pre><span></span><code><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vertical-stack</span>
<span class=nt>cards</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">custom:mushroom-title-card</span>
<span class=w>    </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Shower</span>
<span class=w>    </span><span class=nt>subtitle</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Shower details via EMS-ESP</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">horizontal-stack</span>
<span class=w>    </span><span class=nt>cards</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">custom:mushroom-entity-card</span>
<span class=w>        </span><span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">binary_sensor.ems_esp_shower_active</span>
<span class=w>        </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mdi:shower</span>
<span class=w>        </span><span class=nt>icon_color</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">red</span>
<span class=w>        </span><span class=nt>primary_info</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>        </span><span class=nt>secondary_info</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">horizontal-stack</span>
<span class=w>    </span><span class=nt>cards</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">custom:mushroom-entity-card</span>
<span class=w>        </span><span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sensor.last_shower_time</span>
<span class=w>        </span><span class=nt>primary_info</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>        </span><span class=nt>secondary_info</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">last-updated</span>
<span class=w>        </span><span class=nt>icon_color</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">amber</span>
<span class=w>        </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mdi:calendar-month</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">horizontal-stack</span>
<span class=w>    </span><span class=nt>cards</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">custom:mushroom-entity-card</span>
<span class=w>        </span><span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sensor.last_shower_duration</span>
<span class=w>        </span><span class=nt>primary_info</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>        </span><span class=nt>secondary_info</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class=w>        </span><span class=nt>icon_color</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">amber</span>
<span class=w>        </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mdi:camera-timer</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>show_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>show_icon</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">button</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Send cold shot of water</span>
<span class=w>    </span><span class=nt>tap_action</span><span class=p>:</span>
<span class=w>    </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">call-service</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">script.coldshot</span>
<span class=w>    </span><span class=nt>show_state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>    </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mdi:snowflake-alert</span>
<span class=w>    </span><span class=nt>icon_height</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">24px</span>
</code></pre></div> <h3 id=alert-change-of-thermostat-set-temperature>Alert change of thermostat set temperature<a class=headerlink href=#alert-change-of-thermostat-set-temperature title="Permanent link">~</a></h3> <div class=highlight><pre><span></span><code><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Thermostat Alert</span>
<span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&#39;&#39;</span>
<span class=nt>trigger</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>    </span><span class=nt>entity_id</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">number.ems_esp_thermostat_hc1_seltemp</span>
<span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
<span class=nt>action</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">notify.notify</span>
<span class=w>    </span><span class=nt>data</span><span class=p>:</span>
<span class=w>      </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Thermostat alert</span>
<span class=w>      </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;-</span>
<span class=w>        </span><span class=no>Temperature set to {{ states(&#39;number.ems_esp_thermostat_hc1_seltemp&#39;) }}</span>
<span class=w>        </span><span class=no>degrees</span>
<span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">single</span>
</code></pre></div> <h3 id=activating-one-time-hot-water-charging-dhw-once-using-mqtt>Activating one-time hot water charging DHW once using MQTT<a class=headerlink href=#activating-one-time-hot-water-charging-dhw-once-using-mqtt title="Permanent link">~</a></h3> <p>Below is an example of calling a command (OneTimeWater)</p> <p><code>switch</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>one_time_water</span><span class=p>:</span>
<span class=w>  </span><span class=nt>friendly_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OneTimeWater</span>
<span class=w>  </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>is_state(&#39;sensor.one_time_water&#39;,</span><span class=nv> </span><span class=s>&#39;on&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>  </span><span class=nt>turn_on</span><span class=p>:</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">script.turn_on</span>
<span class=w>    </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">script.one_time_water_on</span>
<span class=w>  </span><span class=nt>turn_off</span><span class=p>:</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">script.turn_on</span>
<span class=w>    </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">script.one_time_water_off</span>
</code></pre></div> <p><code>scripts</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>one_time_water_on</span><span class=p>:</span>
<span class=w>  </span><span class=nt>sequence</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mqtt.publish</span>
<span class=w>      </span><span class=nt>data</span><span class=p>:</span>
<span class=w>        </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=s>&#39;ems-esp/boiler&#39;</span>
<span class=w>        </span><span class=nt>payload</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{&quot;cmd&quot;:&quot;wwonetime&quot;,&quot;data&quot;:1}&#39;</span>

<span class=nt>one_time_water_off</span><span class=p>:</span>
<span class=w>  </span><span class=nt>sequence</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mqtt.publish</span>
<span class=w>      </span><span class=nt>data</span><span class=p>:</span>
<span class=w>        </span><span class=nt>topic</span><span class=p>:</span><span class=w> </span><span class=s>&#39;ems-esp/boiler&#39;</span>
<span class=w>        </span><span class=nt>payload</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{&quot;cmd&quot;:&quot;wwonetime&quot;,&quot;data&quot;:0}&#39;</span>
</code></pre></div> <h3 id=calculating-values>Calculating values<a class=headerlink href=#calculating-values title="Permanent link">~</a></h3> <p>(from @Glitter-ball)</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class=w>  </span><span class=nt>sensors</span><span class=p>:</span>
<span class=w>    </span><span class=nt>differential</span><span class=p>:</span>
<span class=w>      </span><span class=nt>friendly_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Flow-Ret</span><span class=nv> </span><span class=s>diff&#39;</span>
<span class=w>      </span><span class=nt>unit_of_measurement</span><span class=p>:</span><span class=w> </span><span class=s>&#39;°C&#39;</span>
<span class=w>      </span><span class=nt>icon_template</span><span class=p>:</span><span class=w> </span><span class=s>&#39;mdi:format-align-middle&#39;</span>
<span class=w>      </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>(states(&#39;sensor.flow_temperature&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>float</span><span class=nv> </span><span class=s>-</span><span class=nv> </span><span class=s>state(&#39;sensor.return_temp&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>float)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>round(1)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <h3 id=solar-pump-working-hours>Solar Pump Working Hours<a class=headerlink href=#solar-pump-working-hours title="Permanent link">~</a></h3> <p>(from @PhillyGilly)</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mqtt</span>
<span class=w>  </span><span class=nt>state_topic</span><span class=p>:</span><span class=w> </span><span class=s>&#39;ems-esp/solar_data&#39;</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Solar</span><span class=nv> </span><span class=s>Pump</span><span class=nv> </span><span class=s>working</span><span class=nv> </span><span class=s>hours&#39;</span>
<span class=w>  </span><span class=nt>unit_of_measurement</span><span class=p>:</span><span class=w> </span><span class=s>&#39;hr&#39;</span>
<span class=w>  </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
<span class=w>    </span><span class=no>{% set mins = value_json.pumpWorkMin %}</span>
<span class=w>    </span><span class=no>{% set hours = ((mins | int / 60) | string).split(&#39;.&#39;)[0] %}</span>
<span class=w>    </span><span class=no>{{hours}}</span>
<span class=w>  </span><span class=nt>qos</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>  </span><span class=nt>payload_available</span><span class=p>:</span><span class=w> </span><span class=s>&#39;online&#39;</span>
<span class=w>  </span><span class=nt>payload_not_available</span><span class=p>:</span><span class=w> </span><span class=s>&#39;offline&#39;</span>
</code></pre></div> <h3 id=reading-a-value-via-the-api>Reading a value via the API<a class=headerlink href=#reading-a-value-via-the-api title="Permanent link">~</a></h3> <p>Although all the EMS-ESP data is available in Home Assistant as various sensor types you can optionally also call commands and read data using the REST API interface. For example in the script below which will trigger HA to fetch the MAC address when HA is restarted:</p> <div class=highlight><pre><span></span><code><span class=nt>sensor</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rest</span>
<span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://ems-esp.local/api/system</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">emsesp_MAC</span>
<span class=w>    </span><span class=nt>value_template</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>value_json.Network.MAC</span><span class=nv> </span><span class=s>}}&#39;</span>
</code></pre></div> <h3 id=changing-a-value-via-the-api>Changing a value via the API<a class=headerlink href=#changing-a-value-via-the-api title="Permanent link">~</a></h3> <p><code>configuration.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>rest_command</span><span class=p>:</span>
<span class=w>  </span><span class=nt>emsesp</span><span class=p>:</span>
<span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://ems-esp.local/api/{{device}}</span>
<span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">POST</span>
<span class=w>    </span><span class=nt>headers</span><span class=p>:</span>
<span class=w>      </span><span class=nt>authorization</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Bearer</span><span class=nv> </span><span class=s>&lt;Your</span><span class=nv> </span><span class=s>Secure</span><span class=nv> </span><span class=s>key</span><span class=nv> </span><span class=s>from</span><span class=nv> </span><span class=s>the</span><span class=nv> </span><span class=s>UI&gt;&#39;</span>
<span class=w>    </span><span class=nt>content_type</span><span class=p>:</span><span class=w> </span><span class=s>&#39;application/json&#39;</span>
<span class=w>    </span><span class=nt>payload</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{&quot;entity&quot;:&quot;{{entity}}&quot;,&quot;value&quot;:&quot;{{value}}&quot;}&#39;</span>

<span class=nt>input_number</span><span class=p>:</span>
<span class=w>  </span><span class=nt>wwselected_temp</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">WW Selected Temperature</span>
<span class=w>    </span><span class=nt>min</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class=w>    </span><span class=nt>max</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class=w>    </span><span class=nt>step</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>    </span><span class=nt>icon</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mdi:coolant-temperature</span>
</code></pre></div> <p>in the automations:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s>&#39;change_ww_seltemp&#39;</span>
<span class=w>  </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=s>&#39;change</span><span class=nv> </span><span class=s>ww</span><span class=nv> </span><span class=s>selected</span><span class=nv> </span><span class=s>temp&#39;</span>
<span class=w>  </span><span class=nt>trigger</span><span class=p>:</span>
<span class=w>    </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>    </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">input_number.wwselected_temp</span>
<span class=w>  </span><span class=nt>action</span><span class=p>:</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rest_command.emsesp</span>
<span class=w>    </span><span class=nt>data</span><span class=p>:</span>
<span class=w>      </span><span class=nt>device</span><span class=p>:</span><span class=w> </span><span class=s>&#39;boiler&#39;</span>
<span class=w>      </span><span class=nt>entity</span><span class=p>:</span><span class=w> </span><span class=s>&#39;wwseltemp&#39;</span>
<span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>states(&#39;input_number.wwselected_temp&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>int</span><span class=nv> </span><span class=s>}}&quot;</span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s>&#39;set_ww_seltemp&#39;</span>
<span class=w>  </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=s>&#39;set</span><span class=nv> </span><span class=s>ww</span><span class=nv> </span><span class=s>selected</span><span class=nv> </span><span class=s>temp&#39;</span>
<span class=w>  </span><span class=nt>trigger</span><span class=p>:</span>
<span class=w>    </span><span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class=w>    </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sensor.thermostat_hc1_selected_room_temperature</span>
<span class=w>  </span><span class=nt>action</span><span class=p>:</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">input_number.set_value</span>
<span class=w>    </span><span class=nt>target</span><span class=p>:</span>
<span class=w>      </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">input_number.wwselected_temp</span>
<span class=w>    </span><span class=nt>data</span><span class=p>:</span>
<span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>states(&#39;sensor.boiler_ww_selected_temperature&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>int</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>Then in your HA's lovelace UI add then entity called <code>input_number.wwselected_temp</code>.</p> <p>Now in HA you can dynamically adjust the values. Like:</p> <p><img alt="Screenshot 2021-08-08 143712" src=https://user-images.githubusercontent.com/1230712/128632199-7815d649-40a8-4f11-99e3-eacc16bf53a4.png></p> <p>Check if it's working by going to <code>http://ems-esp/api/boiler/wwseltemp</code></p> <h3 id=showing-the-boiler-status-based-on-the-service-code>Showing the Boiler status based on the service code<a class=headerlink href=#showing-the-boiler-status-based-on-the-service-code title="Permanent link">~</a></h3> <p>(by @glitterball)</p> <p>Use a template to translate the boiler service code into a string.</p> <p>in <code>configuration.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class=kt>!include</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">template.yaml</span>
</code></pre></div> <p>and <code>template.yaml</code> contains:</p> <div class=highlight><pre><span></span><code><span class=nt>sensor</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Status&#39;</span>
<span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
<span class=w>      </span><span class=no>{% set sc = states(&#39;sensor.boiler_service_code_number&#39;) %}</span>
<span class=w>      </span><span class=no>{% if sc == &#39;200&#39; %} CH active</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;201&#39; %} HW active</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;202&#39; %} CH anti cycle</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;203&#39; %} Standby</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;204&#39; %} CH cooling</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;208&#39; %} Service test</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;265&#39; %} Low CH load</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;268&#39; %} Component test</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;270&#39; %} Power up</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;283&#39; %} Burner start</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;284&#39; %} Ignition</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;305&#39; %} HW anti cycle</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;357&#39; %} Air purge</span>
<span class=w>      </span><span class=no>{% elif sc == &#39;358&#39; %} Valve kick</span>
<span class=w>      </span><span class=no>{% else %} {{ sc }}</span>
<span class=w>      </span><span class=no>{% endif %}</span>
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 2, 2024</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://discord.gg/3J3GgnzpyT target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/emsesp/EMS-ESP32 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.56dfad97.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> <script src=../extra_javascript/github.js></script> </body> </html>